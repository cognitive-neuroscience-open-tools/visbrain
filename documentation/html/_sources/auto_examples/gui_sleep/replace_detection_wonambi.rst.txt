
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/gui_sleep/replace_detection_wonambi.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_gui_sleep_replace_detection_wonambi.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_gui_sleep_replace_detection_wonambi.py:


Replace detection with wonambi algorithm
========================================

This example illustrates how to replace the default spindle detection algorithm
with those implemented inside wonambi.

This example uses the wonambi package. See
https://wonambi-python.github.io/installation.html for a detailed installation.

.. warning::

    After running this script, just go to the Detection panel and run the
    selected detection by clicking on Apply. The software will automatically
    use your new detection algorithm. The Python console should confirm that
    you're using the new method and not the default method.

Required dataset at :
https://www.dropbox.com/s/bj1ra95rbksukro/sleep_edf.zip?dl=1

.. image:: ../../_static/examples/ex_replace_detection_wonambi.png

.. GENERATED FROM PYTHON SOURCE LINES 24-26

Load your file and create an instance of Sleep
##############################################################################

.. GENERATED FROM PYTHON SOURCE LINES 26-48

.. code-block:: Python


    import os
    import numpy as np

    from visbrain.gui import Sleep
    from visbrain.io import download_file, path_to_visbrain_data

    from wonambi.detect.spindle import DetectSpindle, detect_Moelle2011
    from wonambi.detect.slowwave import DetectSlowWave, detect_Massimini2004

    # Download the file :
    download_file('sleep_edf.zip', unzip=True, astype='example_data')
    target_path = path_to_visbrain_data(folder='example_data')

    # Get data path :
    dfile = os.path.join(target_path, 'excerpt2.edf')            # data
    hfile = os.path.join(target_path, 'Hypnogram_excerpt2.txt')  # hypnogram
    cfile = os.path.join(target_path, 'excerpt2_config.txt')     # GUI config

    # Define an instance of Sleep :
    sp = Sleep(data=dfile, hypno=hfile, config_file=cfile)


.. GENERATED FROM PYTHON SOURCE LINES 49-51

Define new methods
##############################################################################

.. GENERATED FROM PYTHON SOURCE LINES 53-55

Spindle function
~~~~~~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 55-73

.. code-block:: Python


    # Define a DetectSpindle instance :
    opts_spin = DetectSpindle('Moelle2011')
    # Define the function to replace :
    def fcn_spindle(data, sf, time, hypno):  # noqa
        """New spindle detection function.

        See : https://wonambi-python.github.io/api/wonambi.detect.spindle.html
        for an exhaustive list of implemented detections inside wonambi.
        """
        out, _, _ = detect_Moelle2011(data, sf, time, opts_spin)
        indices = np.zeros((len(out), 2))
        for i, k in enumerate(out):
            indices[i, 0] = k['start']
            indices[i, 1] = k['end']
        indices *= sf
        return indices.astype(int)


.. GENERATED FROM PYTHON SOURCE LINES 74-76

Slow-waves function
~~~~~~~~~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 76-94

.. code-block:: Python


    # Define a DetectSlowWave instance :
    opts_sw = DetectSlowWave('Massimini2004')
    # Define the function to replace :
    def fcn_slowwave(data, sf, time, hypno):  # noqa
        """New slowwave detection function.

        See : https://wonambi-python.github.io/api/wonambi.detect.slowwave.html
        for an exhaustive list of implemented detections inside wonambi.
        """
        out = detect_Massimini2004(data, sf, time, opts_sw)
        indices = np.zeros((len(out), 2))
        for i, k in enumerate(out):
            indices[i, 0] = k['start']
            indices[i, 1] = k['end']
        indices *= sf
        return indices.astype(int)


.. GENERATED FROM PYTHON SOURCE LINES 95-99

Replace existing methods
##############################################################################
 Now we use the :class:`visbrain.gui.Sleep.replace_detections` method to
 overwrite existing spindles and slow-waves detections.

.. GENERATED FROM PYTHON SOURCE LINES 99-107

.. code-block:: Python


    # Replace the spindle detection function :
    sp.replace_detections('spindle', fcn_spindle)
    # Replace the slow-wave detection function :
    sp.replace_detections('sw', fcn_slowwave)

    # Finally, open the graphical user interface :
    sp.show()


.. _sphx_glr_download_auto_examples_gui_sleep_replace_detection_wonambi.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: replace_detection_wonambi.ipynb <replace_detection_wonambi.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: replace_detection_wonambi.py <replace_detection_wonambi.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: replace_detection_wonambi.zip <replace_detection_wonambi.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
